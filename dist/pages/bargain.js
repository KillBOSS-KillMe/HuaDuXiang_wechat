"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,a){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?t:a}function _inherits(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(t,a):t.__proto__=a)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,a){for(var e=0;e<a.length;e++){var s=a[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(a,e,s){return e&&t(a.prototype,e),s&&t(a,s),a}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_mask=require("./../components/mask.js"),_mask2=_interopRequireDefault(_mask),_ajax=require("./../ajax.js"),api=require("./../api.js"),Index=function(t){function a(){var t,e,s,o;_classCallCheck(this,a);for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];return e=s=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(i))),s.config={navigationBarTitleText:"砍价",enablePullDownRefresh:!0},s.$repeat={},s.$props={attrsmask:{"xmlns:v-bind":"","v-bind:maskFlag.sync":"attrFlag"},addressmask:{"v-bind:maskFlag.sync":"addressFlag"},sharesmask:{"v-bind:maskFlag.sync":"shareFlag"}},s.$events={},s.components={attrsmask:_mask2.default,addressmask:_mask2.default,sharesmask:_mask2.default},s.mixins=[],s.data={goodsNum:1,propArr:[1,2,3],attrFlag:!1,addressFlag:!1,shareFlag:!1,requestImgUrl:"",barginData:[],topImg:"",goods_id:"",attr:[],activeAttr:[],goods_spec:[],spec_list:{},image_list:[],goods_content:"",address:"",curpage:1,hasmore:!1,allpage:null,kanjia_price:0},s.computed={},s.methods={addressBtnSubmit:function(){var t=this;if(!this.address)return wx.showToast({title:"请选择地址",icon:"none"}),!1;(0,_ajax.ajax)({url:api.memberKanjia,data:{goods_id:this.goods_id,address_id:this.address.address_id}}).then(function(a){200==a.code&&(0==a.datas.state?wx.showToast({title:a.datas.msg,icon:"none"}):(t.kanjia_price=a.datas.kanjia_price,t.addressFlag=!1,t.shareFlag=!0,t.$apply(),wx.stopPullDownRefresh()))})},attrBtnSubmit:function(){this.attrFlag=!1,this.addressFlag=!0},reduNum:function(){1!=this.goodsNum&&this.goodsNum--},addNum:function(){this.goodsNum++},jumpTimeDetails:function(t,a){this.attrFlag=!0,this.goods_id=t,this.$apply(),this.getShopDetails()},hideMask:function(){},changeAttr:function(t,a,e){this.attr[t].active=a,this.goods_id=this.spec_list[this.attr.map(function(t){return t.active}).sort().join("|")],this.$apply(),this.getShopDetails()}},s.events={},o=e,_possibleConstructorReturn(s,o)}return _inherits(a,t),_createClass(a,[{key:"onShow",value:function(){var t=this.$parent,a=t.globalData.address;this.address=a}},{key:"getShopDetails",value:function(){var t=this;(0,_ajax.ajax)({url:api.ordinaryGoodsDtail,type:"get",data:{goods_id:this.goods_id}}).then(function(a){if(200==a.code){t.goods_content=a.datas.goods_content,t.image_list=a.datas.image_list||[];var e=Object.values(a.datas.goods_content.spec_name||{}),s=Object.values(a.datas.goods_content.spec_value||{}),o=Object.keys(a.datas.goods_content.goods_spec||{});t.activeAttr=o,t.goods_spec=Object.values(a.datas.goods_content.goods_spec||{});var r=[];s.forEach(function(t,a){r[a]||(r[a]={}),r[a].title=e[a],r[a].prop=t}),r.forEach(function(t){for(var a in t.prop)o.forEach(function(e){e==a&&(t.active=a)})}),t.attr=r,t.spec_list=a.datas.spec_list,t.$apply()}})}},{key:"onLoad",value:function(){var t=this;this.requestImgUrl=this.$parent.globalData.requestImgUrl,this.bargainGoodsList(),(0,_ajax.ajax)({url:api.memberKj}).then(function(a){t.topImg=a.datas.img_area,t.$apply()})}},{key:"onShareAppMessage",value:function(t){var a=wx.getStorageSync("user");return console.log("goods_id="+this.goods_id+"&userid="+a.userid),{path:"/pages/barginInfo?goods_id="+this.goods_id+"&userid="+a.userid}}},{key:"bargainGoodsList",value:function(){var t=this;(0,_ajax.ajax)({url:api.bargainGoodsList,data:{page:10,curpage:this.curpage}}).then(function(a){var e=a.datas.list||[];t.barginData=t.barginData.concat(e),t.hasmore=a.datas.hasmore,t.allpage=a.datas.allpage||0,t.$apply(),wx.stopPullDownRefresh()})}},{key:"onReachBottom",value:function(){this.hasmore&&(this.curpage++,this.bargainGoodsList())}},{key:"onPullDownRefresh",value:function(t){this.curpage=1,this.barginData=[],this.hasmore=!1,this.bargainGoodsList()}}]),a}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/bargain"));