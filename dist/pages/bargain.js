"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var s=e[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,a,s){return a&&t(e.prototype,a),s&&t(e,s),e}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_mask=require("./../components/mask.js"),_mask2=_interopRequireDefault(_mask),_ajax=require("./../ajax.js"),api=require("./../api.js"),Index=function(t){function e(){var t,a,s,o;_classCallCheck(this,e);for(var i=arguments.length,r=Array(i),n=0;n<i;n++)r[n]=arguments[n];return a=s=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(r))),s.config={navigationBarTitleText:"砍价"},s.$repeat={},s.$props={attrsmask:{"xmlns:v-bind":"","v-bind:maskFlag.sync":"attrFlag"},addressmask:{"v-bind:maskFlag.sync":"addressFlag"},sharesmask:{"v-bind:maskFlag.sync":"shareFlag"}},s.$events={},s.components={attrsmask:_mask2.default,addressmask:_mask2.default,sharesmask:_mask2.default},s.mixins=[],s.data={goodsNum:1,propArr:[1,2,3],attrFlag:!1,addressFlag:!1,shareFlag:!1,requestImgUrl:"",barginData:[],topImg:"",goods_id:"",attr:[],activeAttr:[],goods_spec:[],spec_list:{},image_list:[],goods_content:"",address:"",curpage:1,hasmore:!1,allpage:null,kanjia_price:0},s.computed={},s.methods={addressBtnSubmit:function(){var t=this;if(!this.address)return wx.showToast({title:"请选择地址",icon:"none"}),!1;(0,_ajax.ajax)({url:api.memberKanjia,data:{goods_id:this.goods_id,address_id:this.address.address_id}}).then(function(e){200==e.code&&(0==e.datas.state?wx.showToast({title:e.datas.msg,icon:"none"}):(t.kanjia_price=e.datas.kanjia_price,t.addressFlag=!1,t.shareFlag=!0,t.$apply()))})},attrBtnSubmit:function(){this.attrFlag=!1,this.addressFlag=!0},reduNum:function(){1!=this.goodsNum&&this.goodsNum--},addNum:function(){this.goodsNum++},jumpTimeDetails:function(t,e){this.attrFlag=!0,this.goods_id=t,this.$apply(),this.getShopDetails()},hideMask:function(){},changeAttr:function(t,e,a){this.activeAttr[t]=e,this.goods_spec[t]=a;var s=this.spec_list[this.activeAttr.join("|")];this.goods_id=s,this.$apply(),this.getShopDetails()}},s.events={},o=a,_possibleConstructorReturn(s,o)}return _inherits(e,t),_createClass(e,[{key:"onShow",value:function(){var t=this.$parent,e=t.globalData.address;this.address=e}},{key:"getShopDetails",value:function(){var t=this;(0,_ajax.ajax)({url:api.ordinaryGoodsDtail,type:"get",data:{goods_id:this.goods_id}}).then(function(e){if(200==e.code){t.goods_content=e.datas.goods_content,t.image_list=e.datas.image_list||[];var a=Object.values(e.datas.goods_content.spec_name||{}),s=Object.values(e.datas.goods_content.spec_value||{}),o=[];s.forEach(function(t,e){o[e]||(o[e]={}),o[e].title=a[e],o[e].prop=t}),t.attr=o,t.goods_spec=Object.values(e.datas.goods_content.goods_spec||{}),t.activeAttr=Object.keys(e.datas.goods_content.goods_spec||{}),t.spec_list=e.datas.spec_list,t.$apply()}})}},{key:"onLoad",value:function(){var t=this;this.requestImgUrl=this.$parent.globalData.requestImgUrl,this.bargainGoodsList(),(0,_ajax.ajax)({url:api.memberKj}).then(function(e){t.topImg=e.datas.img_area,t.$apply()})}},{key:"onShareAppMessage",value:function(t){if("button"==t.from){var e=wx.getStorageSync("user");return{path:"/pages/barginInfo?goods_id="+this.goods_id+"&userid="+e.userid}}}},{key:"bargainGoodsList",value:function(){var t=this;(0,_ajax.ajax)({url:api.bargainGoodsList,data:{page:10,curpage:this.curpage}}).then(function(e){t.barginData=e.datas.list,t.hasmore=e.datas.hasmore,t.allpage=e.datas.allpage||0,t.$apply()})}},{key:"onReachBottom",value:function(){this.hasmore&&(this.curpage++,this.requestIndexGoodsList())}}]),e}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/bargain"));