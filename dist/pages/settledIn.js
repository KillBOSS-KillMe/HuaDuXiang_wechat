"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(s,r){try{var o=t[s](r),i=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});e(i)}return a("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_ajax=require("./../ajax.js"),_mask=require("./../components/mask.js"),_mask2=_interopRequireDefault(_mask),api=require("./../api.js"),Index=function(e){function t(){var e,n,a,s;_classCallCheck(this,t);for(var r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),a.config={navigationBarTitleText:"商家入驻"},a.$repeat={},a.$props={paymask:{"xmlns:v-bind":"","v-bind:maskFlag.sync":"payFlag"}},a.$events={},a.components={paymask:_mask2.default},a.mixins=[],a.data={payFlag:!1,status:null,storeGrade:[],timeArr:[{num:1},{num:2},{num:3}],storeGradeIndex:0,timeIndex:0,useCostPrice:0,bondPrice:0,paying_amount:0,storeClass:[],storeClassIndex:0,storeClassList:[],store_id:"",joinInfo:{},entryIndex:[0,0,0],entryName:"",entryId:null,entryArr:[],type:1,payment_type:1,available_predeposit:0,password:""},a.computed={useCostPrice:function(){var e=this.timeArr[this.timeIndex].num,t=this.storeGrade[this.storeGradeIndex]&&this.storeGrade[this.storeGradeIndex].sg_price;return(Number(e)*Number(t)).toFixed(2)},bondPrice:function(){var e=this.storeClass[this.storeClassIndex]&&this.storeClass[this.storeClassIndex].sc_bail;return Number(e).toFixed(2)}},a.watch={},a.methods={submit:function(e){var t=e.detail.value,n=t.admin,a=t.password,s=t.name,r=t.code,o=t.contacts,i=t.phone,u=t.address,c=t.remarks;return/^(\w){6,20}$/.test(n)?/^(\w){6,20}$/.test(a)?s?/^(\w){6,20}$/.test(r)?o?11!=i.length?(wx.showToast({title:"请输入正确的联系电话",icon:"none"}),!1):u?this.entryName?c?void(0,_ajax.ajax)({url:api.addStore,data:{store_name:s,store_code:r,contacts_name:o,contacts_phone:i,company_address_detail:u,remark:c,joinin_year:this.timeArr[this.timeIndex].num,sc_id:this.storeClass[this.storeClassIndex].sc_id,sc_name:this.storeClass[this.storeClassIndex].sc_name,sc_bail:this.storeClass[this.storeClassIndex].sc_bail,sg_id:this.storeGrade[this.storeGradeIndex].sg_id,sg_name:this.storeGrade[this.storeGradeIndex].sg_name,sg_info:this.storeGrade[this.storeGradeIndex].sg_price,seller_name:n,seller_psw:a,store_class_ids:this.entryId,store_class_names:this.entryName,type:this.type}}).then(function(e){wx.showToast({title:e.datas.msg,icon:"none"});var t=setTimeout(function(){wx.reLaunch({url:"/pages/settledIn"}),clearTimeout(t)},1e3)}):(wx.showToast({title:"请输入备注",icon:"none"}),!1):(wx.showToast({title:"请输入店铺条目",icon:"none"}),!1):(wx.showToast({title:"请输入商铺地址",icon:"none"}),!1):(wx.showToast({title:"请输入联系人姓名",icon:"none"}),!1):(wx.showToast({title:"请输入6至20位商铺编号",icon:"none"}),!1):(wx.showToast({title:"请输入商铺名称",icon:"none"}),!1):(wx.showToast({title:"请输入6至20位密码",icon:"none"}),!1):(wx.showToast({title:"请输入6至20位商铺账号",icon:"none"}),!1)},storeGradeChange:function(e){var t=e.detail.value;this.storeGradeIndex=t},timeChange:function(e){this.timeIndex=e.detail.value},storeClassChange:function(e){this.storeClassIndex=e.detail.value},bindMultiPickerChange:function(e){var t=e.detail.value;this.entryIndex=t;var n=this.entryArr;this.entryName=n[0][t[0]].gc_name+","+n[1][t[1]].gc_name+","+n[2][t[2]].gc_name,this.entryId=n[0][t[0]].gc_id+","+n[1][t[1]].gc_id+","+n[2][t[2]].gc_id},bindMultiPickerColumnChange:function(e){this.setList(e.detail.column,e.detail.value)},againInfo:function(e){this.status=-10},pay:function(){var e=this;if(!this.password)return wx.showToast({title:"请输入密码",icon:"none"}),!1;(0,_ajax.ajax)({url:api.joinPay,data:{password:this.password}}).then(function(t){if(200==t.code)if(1==t.datas.state){wx.showToast({title:t.datas.msg});var n=setTimeout(function(){wx.reLaunch({url:"/pages/settledIn"}),clearTimeout(n)},1e3)}else-4==t.datas.state?wx.showModal({title:"提醒",content:"余额不足，是否前往充值？",success:function(t){t.confirm&&e.$redirect("vip")}}):wx.showToast({title:t.datas.msg,icon:"none"})})},inputPassword:function(e){this.password=e.detail.value},settledIn:function(){this.payFlag=!0}},a.events={},s=n,_possibleConstructorReturn(a,s)}return _inherits(t,e),_createClass(t,[{key:"onShow",value:function(){var e=this;(0,_ajax.ajax)({url:api.memberInfo}).then(function(t){200==t.code&&(e.available_predeposit=Number(t.datas.member_data.available_predeposit),e.$apply())})}},{key:"setList",value:function(e,t){var n=this.entryArr[0];if(0==e)this.entryArr[1]=n[t].two,this.entryArr[2]=n[t].two[0].three;else if(1==e)this.entryArr[2]=this.entryArr[1][t].three;else if(3==e)return!1}},{key:"onLoad",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.next=3,(0,_ajax.ajax)({url:api.isJoin,type:"get"}).then(function(e){if(n.status=e.datas.state,-10!=e.datas.state){n.type=2,n.joinInfo=e.datas.data;var t=n.joinInfo.joinin_year;n.entryId=n.joinInfo.store_class_ids,n.entryName=n.joinInfo.store_class_names,n.paying_amount=n.joinInfo.paying_amount,n.timeArr.forEach(function(e,a){e.num==t&&(n.timeIndex=a)})}n.store_id=e.datas.store_id,n.$apply()});case 3:(0,_ajax.ajax)({url:api.getStoreGrade}).then(function(e){n.storeGrade=e.datas.data;var t=n.joinInfo.sg_id;e.datas.data.forEach(function(e,a){e.sg_id==t&&(n.storeGradeIndex=a)}),n.$apply()}),(0,_ajax.ajax)({url:api.getStoreClass}).then(function(e){n.storeClass=e.datas.data||[];var t=n.joinInfo.sc_id;e.datas.data.forEach(function(e,a){e.sc_id==t&&(n.storeClassIndex=a)}),n.$apply()}),(0,_ajax.ajax)({url:api.oneGoodsClass}).then(function(e){var t=e.datas,a=t[0].two,s=a[0].three,r=[];r.push(t),r.push(a),r.push(s),n.entryArr=r,n.$apply()});case 6:case"end":return e.stop()}},e,this)}));return e}()}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/settledIn"));