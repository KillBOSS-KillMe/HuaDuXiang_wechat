"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,o){function s(n,a){try{var r=e[n](a),i=r.value}catch(t){return void o(t)}if(!r.done)return Promise.resolve(i).then(function(t){s("next",t)},function(t){s("throw",t)});t(i)}return s("next")})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var s=e[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,o,s){return o&&t(e.prototype,o),s&&t(e,s),e}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_mask=require("./../components/mask.js"),_mask2=_interopRequireDefault(_mask),_ajax=require("./../ajax.js"),_base=require("./../utils/base.js"),timer=require("./../utils/wxTimer.js"),api=require("./../api.js"),WxParse=require("./../utils/wxParse/wxParse.js"),Index=function(t){function e(){var t,o,s,n;_classCallCheck(this,e);for(var a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];return o=s=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(r))),s.config={navigationBarTitleText:"商品详情"},s.$repeat={},s.$props={couponmask:{"v-bind:maskFlag.sync":"couponFlag"},attrsmask:{"xmlns:v-bind":"","v-bind:maskFlag.sync":"attrFlag"}},s.$events={},s.components={couponmask:_mask2.default,attrsmask:_mask2.default},s.mixins=[],s.data={couponFlag:!1,voucher_list:[],goodsNum:1,attrFlag:!1,tabList:[{name:"商品介绍",dotNum:2},{name:"图文详情",dotNum:3}],currentTab:0,wxTimerList:{},goods_id:null,requestImgUrl:null,goods_content:null,store_info:null,goods_commend_list:[],image_list:[],contractlist:{},attr:[],activeAttr:[],goods_spec:[],spec_list:{},end_time:0},s.computed={},s.methods={switchNav:function(t){this.currentTab=t},showAttrMask:function(){this.attrFlag=!0},attrBtnSubmit:function(){var t=this;if(this.wxTimerList.firstTimer.wxTimerSecond<=0)return wx.showToast({title:"本场已结束，请等待下场活动",icon:"none"}),!1;var e=this.$parent,o=this.goods_id,s=this.goodsNum,n=o+"|"+s;(0,_ajax.ajax)({url:api.memberBuyOne,data:{cart_id:n}}).then(function(o){200==o.code&&(o.datas.cart_id=n,e.globalData.orderInfo=o.datas,t.$navigate({url:"/pages/settlement"}))})},navGoodsDetails:function(t,e){"rushsales"==e?this.$redirect("/pages/seckillShopDetails?goods_id="+t):this.$redirect("/pages/shopDetails?goods_id="+t)},changeAttr:function(t,e,o){this.activeAttr[t]=e,this.goods_spec[t]=o;var s=this.spec_list[this.activeAttr.join("|")];this.goods_id=s,this.$apply(),this.getShopDetails()},addNum:function(){var t=this.goods_content.upper_limit;if(0!=t&&Number(t)<=Number(this.goodsNum))return wx.showToast({title:"单次最多选择"+t+"件商品",icon:"none"}),this.goodsNum=t,!1;this.goodsNum++},reduNum:function(){if(this.goodsNum<=1)return this.goodsNum=1,!1;this.goodsNum--},showCouponMask:function(){if(0==this.voucher_list.length)return wx.showToast({title:"暂无优惠券发送",icon:"none"}),!1;this.couponFlag=!0},choiceCoupon:function(t,e,o){var s=this;0==t&&(0,_ajax.ajax)({url:api.voucherFreeex,data:{tid:e}}).then(function(t){1==t.datas?(wx.showToast({title:"领取成功"}),s.voucher_list[o].exists=1,s.$apply()):wx.showToast({title:t.datas.error,icon:"none"})})},hideCoupon:function(){this.couponFlag=!1}},s.events={},n=o,_possibleConstructorReturn(s,n)}return _inherits(e,t),_createClass(e,[{key:"onShow",value:function(){}},{key:"onLoad",value:function(){function t(t){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.goods_id=e.goods_id,this.requestImgUrl=this.$parent.globalData.requestImgUrl,this.$apply(),t.next=5,this.getShopDetails();case 5:(0,_ajax.ajax)({url:api.voucherTplList,data:{store_id:this.store_info.store_id,gettype:"free"}}).then(function(t){var e=t.datas.voucher_list||[];e.forEach(function(t){t.couponTime=(0,_base.formatDate)(t.voucher_t_start_date)+" 至 "+(0,_base.formatDate)(t.voucher_t_end_date)}),o.voucher_list=e,o.$apply()});case 6:case"end":return t.stop()}},t,this)}));return t}()},{key:"getShopDetails",value:function(){function t(){return e.apply(this,arguments)}var e=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this,t.next=3,(0,_ajax.ajax)({url:api.ordinaryGoodsDtail,type:"get",data:{goods_id:this.goods_id,sale_type:"rushsales"}}).then(function(t){if(200==t.code){o.goodsNum=1,o.goods_content=t.datas.goods_content,o.contractlist=t.datas.goods_content.contractlist||{},o.image_list=t.datas.image_list||[],o.store_info=t.datas.store_info,o.goods_commend_list=t.datas.goods_commend_list;var s=Object.values(t.datas.goods_content.spec_name||{}),n=Object.values(t.datas.goods_content.spec_value||{}),a=[];n.forEach(function(t,e){a[e]||(a[e]={}),a[e].title=s[e],a[e].prop=t}),o.attr=a,o.goods_spec=Object.values(t.datas.goods_content.goods_spec||{}),o.activeAttr=Object.keys(t.datas.goods_content.goods_spec||{}),o.spec_list=t.datas.spec_list;var r=t.datas.goods_content.end_time||0;new timer({beginTime:r,name:"firstTimer",complete:function(){}}).start(o),o.$apply();var i=t.datas.goods_content.goods_body;WxParse.wxParse("article","html",i,e,5)}});case 3:case"end":return t.stop()}},t,this)}));return t}()}]),e}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/seckillShopDetails"));