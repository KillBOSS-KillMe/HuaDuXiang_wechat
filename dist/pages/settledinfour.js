"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_step=require("./../components/step.js"),_step2=_interopRequireDefault(_step),_ajax=require("./../ajax.js"),_mask=require("./../components/mask.js"),_mask2=_interopRequireDefault(_mask),api=require("./../api.js"),_=require("./../utils/underscore.js"),Settledinfour=function(e){function t(){var e,n,s,a;_classCallCheck(this,t);for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return n=s=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),s.config={navigationBarTitleText:"入驻审核"},s.$repeat={},s.$props={step:{"xmlns:v-bind":"","v-bind:state.sync":"state"},paymask:{"v-bind:maskFlag.sync":"payFlag"}},s.$events={},s.components={step:_step2.default,paymask:_mask2.default},s.mixins=[],s.data={state:4,options:{},payFlag:!1,storeGradeIndex:0,storeGrade:[],timeArr:[{num:1},{num:2},{num:3}],timeIndex:0,storeClass:[],storeClassIndex:0,entryArr:[],entryName:"",entryId:null,useCostPrice:0,bondPrice:0,member_data:{},paying_amount:0,join_info:{},password:"",payment_type:1},s.computed={useCostPrice:function(){var e=this.timeArr[this.timeIndex].num,t=this.storeGrade[this.storeGradeIndex]&&this.storeGrade[this.storeGradeIndex].sg_price;return(Number(e)*Number(t)).toFixed(2)},bondPrice:function(){var e=this.storeClass[this.storeClassIndex]&&this.storeClass[this.storeClassIndex].sc_bail;return Number(e).toFixed(2)}},s.methods=_defineProperty({showPriceType:function(){this.payFlag=!0},pay:function(){this.$redirect("settledinfive")},storeGradeChange:function(e){var t=e.detail.value;this.storeGradeIndex=t},timeChange:function(e){this.timeIndex=e.detail.value},storeClassChange:function(e){this.storeClassIndex=e.detail.value},bindMultiPickerChange:function(e){var t=e.detail.value;this.entryIndex=t;var n=this.entryArr;this.entryName=n[0][t[0]].gc_name+","+n[1][t[1]].gc_name+","+n[2][t[2]].gc_name,this.entryId=n[0][t[0]].gc_id+","+n[1][t[1]].gc_id+","+n[2][t[2]].gc_id},bindMultiPickerColumnChange:function(e){this.setList(e.detail.column,e.detail.value)},submit:function(e){this.debounce(e)},inputPassword:function(e){this.password=e.detail.value}},"pay",function(){var e=this;if(!this.password)return wx.showToast({title:"请输入密码",icon:"none"}),!1;(0,_ajax.ajax)({url:api.joinPay,data:{password:this.password}}).then(function(t){if(200==t.code)if(1==t.datas.state){wx.showToast({title:t.datas.msg});var n=setTimeout(function(){e.$redirect("settledinfive"),clearTimeout(n)},1e3)}else-4==t.datas.state?wx.showModal({title:"提醒",content:"余额不足，是否前往充值？",success:function(t){t.confirm&&e.$redirect("vip")}}):wx.showToast({title:t.datas.msg,icon:"none"})})}),s.events={},a=n,_possibleConstructorReturn(s,a)}return _inherits(t,e),_createClass(t,[{key:"onShow",value:function(){}},{key:"setList",value:function(e,t){var n=this.entryArr[0];if(0==e)this.entryArr[1]=n[t].two,this.entryArr[2]=n[t].two[0].three;else if(1==e)this.entryArr[2]=this.entryArr[1][t].three;else if(3==e)return!1}},{key:"onLoad",value:function(e){var t=this;if(this.options=e,this.debounce=_.debounce(this.submit,1e3,{immediate:!0}),20==e.state)return(0,_ajax.ajax)({url:api.getJoinInfo}).then(function(e){200==e.code&&1==e.datas.state&&(t.join_info=e.datas.join_info,t.$apply())}),(0,_ajax.ajax)({url:api.memberInfo,icon:"none"}).then(function(e){200==e.code&&(t.member_data=e.datas.member_data,t.$apply())}),!1;(0,_ajax.ajax)({url:api.getStoreGrade,icon:"none"}).then(function(e){t.storeGrade=e.datas.data,t.$apply()}),(0,_ajax.ajax)({url:api.getStoreClass,icon:"none"}).then(function(e){t.storeClass=e.datas.data||[],t.$apply()}),(0,_ajax.ajax)({url:api.oneGoodsClass,icon:"none"}).then(function(e){var n=e.datas,s=n[0].two,a=s[0].three,r=[];r.push(n),r.push(s),r.push(a),t.entryArr=r,t.entryName=n[0].gc_name+","+s[0].gc_name+","+a[0].gc_name,t.entryId=n[0].gc_id+","+s[0].gc_id+","+a[0].gc_id,t.$apply()})}},{key:"submit",value:function(e){var t=this;if(!this.entryName)return wx.showToast({title:"请选择店铺条目",icon:"none"}),!1;(0,_ajax.ajax)({url:api.joinStep3,data:{sc_id:this.storeClass[this.storeClassIndex].sc_id,sc_name:this.storeClass[this.storeClassIndex].sc_name,sc_bail:this.storeClass[this.storeClassIndex].sc_bail,sg_id:this.storeGrade[this.storeGradeIndex].sg_id,sg_name:this.storeGrade[this.storeGradeIndex].sg_name,sg_info:this.storeGrade[this.storeGradeIndex].sg_price,store_class_ids:this.entryId,store_class_names:this.entryName,joinin_year:this.timeArr[this.timeIndex].num}}).then(function(e){if(200==e.code&&(wx.showToast({title:e.datas.msg,icon:"none"}),1==e.datas.state))var n=setTimeout(function(){t.$redirect("settledinfour"),clearTimeout(n)},1e3)})}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Settledinfour,"pages/settledinfour"));