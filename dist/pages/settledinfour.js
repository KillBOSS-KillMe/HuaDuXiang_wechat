"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,s){try{var i=t[a](s),o=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}return r("next")})}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_step=require("./../components/step.js"),_step2=_interopRequireDefault(_step),_ajax=require("./../ajax.js"),_mask=require("./../components/mask.js"),_mask2=_interopRequireDefault(_mask),api=require("./../api.js"),_=require("./../utils/underscore.js"),Settledinfour=function(e){function t(){var e,n,r,a;_classCallCheck(this,t);for(var s=arguments.length,i=Array(s),o=0;o<s;o++)i[o]=arguments[o];return n=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r.config={navigationBarTitleText:"入驻审核"},r.$repeat={},r.$props={step:{"xmlns:v-bind":"","v-bind:state.sync":"state"},paymask:{"v-bind:maskFlag.sync":"payFlag"}},r.$events={},r.components={step:_step2.default,paymask:_mask2.default},r.mixins=[],r.data={state:4,isJoin:"",payFlag:!1,storeGradeIndex:0,storeGrade:[],timeArr:[{num:1},{num:2},{num:3}],timeIndex:0,storeClass:[],storeClassIndex:0,entryArr:[],entryName:"",entryId:null,useCostPrice:0,bondPrice:0,member_data:{},paying_amount:0,join_info:{},password:"",payment_type:1},r.computed={useCostPrice:function(){var e=this.timeArr[this.timeIndex].num,t=this.storeGrade[this.storeGradeIndex]&&this.storeGrade[this.storeGradeIndex].sg_price;return(Number(e)*Number(t)).toFixed(2)},bondPrice:function(){var e=this.storeClass[this.storeClassIndex]&&this.storeClass[this.storeClassIndex].sc_bail;return Number(e).toFixed(2)}},r.methods=_defineProperty({showPriceType:function(){this.payFlag=!0},pay:function(){this.$redirect("settledinfive")},storeGradeChange:function(e){var t=e.detail.value;this.storeGradeIndex=t},timeChange:function(e){this.timeIndex=e.detail.value},storeClassChange:function(e){this.storeClassIndex=e.detail.value},bindMultiPickerChange:function(e){var t=e.detail.value;this.entryIndex=t;var n=this.entryArr;this.entryName=n[0][t[0]].gc_name+","+n[1][t[1]].gc_name+","+n[2][t[2]].gc_name,this.entryId=n[0][t[0]].gc_id+","+n[1][t[1]].gc_id+","+n[2][t[2]].gc_id},bindMultiPickerColumnChange:function(e){this.setList(e.detail.column,e.detail.value)},submit:function(e){this.debounce(e)},inputPassword:function(e){this.password=e.detail.value}},"pay",function(){var e=this;if(!this.password)return wx.showToast({title:"请输入密码",icon:"none"}),!1;(0,_ajax.ajax)({url:api.joinPay,data:{password:this.password}}).then(function(t){if(200==t.code)if(1==t.datas.state){wx.showToast({title:t.datas.msg});var n=setTimeout(function(){e.$redirect("settledinfive"),clearTimeout(n)},1e3)}else-4==t.datas.state?wx.showModal({title:"提醒",content:"余额不足，是否前往充值？",success:function(t){t.confirm&&e.$redirect("vip")}}):wx.showToast({title:t.datas.msg,icon:"none"})})}),r.events={},a=n,_possibleConstructorReturn(r,a)}return _inherits(t,e),_createClass(t,[{key:"onShow",value:function(){}},{key:"setList",value:function(e,t){var n=this.entryArr[0];if(0==e)this.entryArr[1]=n[t].two,this.entryArr[2]=n[t].two[0].three;else if(1==e)this.entryArr[2]=this.entryArr[1][t].three;else if(3==e)return!1}},{key:"onLoad",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.debounce=_.debounce(this.submit,1e3,{immediate:!0}),e.next=3,(0,_ajax.ajax)({url:api.isJoin,icon:"none"});case 3:if(n=e.sent,this.isJoin=n.datas.state,this.$apply(),20!=this.isJoin){e.next=10;break}return(0,_ajax.ajax)({url:api.getJoinInfo}).then(function(e){200==e.code&&1==e.datas.state&&(r.join_info=e.datas.join_info,r.$apply())}),(0,_ajax.ajax)({url:api.memberInfo,icon:"none"}).then(function(e){200==e.code&&(r.member_data=e.datas.member_data,r.$apply())}),e.abrupt("return",!1);case 10:(0,_ajax.ajax)({url:api.getStoreGrade,icon:"none"}).then(function(e){r.storeGrade=e.datas.data,r.$apply()}),(0,_ajax.ajax)({url:api.getStoreClass,icon:"none"}).then(function(e){r.storeClass=e.datas.data||[],r.$apply()}),(0,_ajax.ajax)({url:api.oneGoodsClass,icon:"none"}).then(function(e){var t=e.datas,n=t[0].two,a=n[0].three,s=[];s.push(t),s.push(n),s.push(a),r.entryArr=s,r.entryName=t[0].gc_name+","+n[0].gc_name+","+a[0].gc_name,r.entryId=t[0].gc_id+","+n[0].gc_id+","+a[0].gc_id,r.$apply()});case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"submit",value:function(e){var t=this;if(!this.entryName)return wx.showToast({title:"请选择店铺条目",icon:"none"}),!1;(0,_ajax.ajax)({url:api.joinStep3,data:{sc_id:this.storeClass[this.storeClassIndex].sc_id,sc_name:this.storeClass[this.storeClassIndex].sc_name,sc_bail:this.storeClass[this.storeClassIndex].sc_bail,sg_id:this.storeGrade[this.storeGradeIndex].sg_id,sg_name:this.storeGrade[this.storeGradeIndex].sg_name,sg_info:this.storeGrade[this.storeGradeIndex].sg_price,store_class_ids:this.entryId,store_class_names:this.entryName,joinin_year:this.timeArr[this.timeIndex].num}}).then(function(e){if(200==e.code&&(wx.showToast({title:e.datas.msg,icon:"none"}),1==e.datas.state))var n=setTimeout(function(){t.$redirect("settledinfour"),clearTimeout(n)},1e3)})}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Settledinfour,"pages/settledinfour"));