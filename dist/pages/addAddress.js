"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function _inherits(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},_createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var s=a[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(a,t,s){return t&&e(a.prototype,t),s&&e(a,s),a}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_ajax=require("./../ajax.js"),api=require("./../api.js"),Index=function(e){function a(){var e,t,s,r;_classCallCheck(this,a);for(var i=arguments.length,n=Array(i),d=0;d<i;d++)n[d]=arguments[d];return t=s=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(n))),s.config={},s.data={addressInfo:{},is_default:0,parent_id:null,deep:1,addressArr:[],name:"",phone:"",address:""},s.components={},s.computed={},s.methods={setAddress:function(){this.is_default=0==this.is_default?1:0,this.$apply(),this.addressInfo.is_default=this.is_default},submit:function(e){var a=_extends({},e.detail.value),t=a.address,s=a.name,r=a.phone;return s?11!=r.length?(wx.showToast({title:"请输入正确的手机号码",icon:"none"}),!1):this.addressInfo.area_info?t?void(this.addressInfo.address_id?(0,_ajax.ajax)({url:api.addressEdit,data:{true_name:s,address:t,area_info:this.addressInfo.area_info,tel_phone:r,area_id:this.addressInfo.area_id,city_id:this.addressInfo.city_id,is_default:this.is_default,address_id:this.addressInfo.address_id}}).then(function(e){if(1==e.datas.state){wx.showToast({title:e.datas.msg});var a=setTimeout(function(){wx.navigateBack(),clearTimeout(a)},1e3)}else wx.showToast({title:e.datas.msg,icon:"none"})}):(0,_ajax.ajax)({url:api.addressAdd,data:{true_name:s,address:t,area_info:this.addressInfo.area_info,tel_phone:r,area_id:this.addressInfo.area_id,city_id:this.addressInfo.city_id,is_default:this.is_default}}).then(function(e){if(1==e.datas.state){wx.showToast({title:e.datas.msg});var a=setTimeout(function(){wx.navigateBack(),clearTimeout(a)},1e3)}else wx.showToast({title:e.datas.msg,icon:"none"})})):(wx.showToast({title:"请输入地址",icon:"none"}),!1):(wx.showToast({title:"请选择地区",icon:"none"}),!1):(wx.showToast({title:"请输入姓名",icon:"none"}),!1)},bindMultiPickerChange:function(e){console.log(e);var a=e.detail.value;a=a.map(function(e){return e||0});var t=this.addressArr[0][a[0]].area_name,s=this.addressArr[1][a[1]].area_name,r=this.addressArr[2][a[2]].area_name;this.addressInfo.area_info=t+","+s+","+r,this.addressInfo.city_id=this.addressArr[1][a[1]].area_id,this.addressInfo.area_id=this.addressArr[2][a[2]].area_id,this.$apply()},bindMultiPickerColumnChange:function(e){var a=e.detail.column,t=e.detail.value;this.parent_id=this.addressArr[a][t].area_id,this.deep=a+2,this.$apply(),a<2&&this.requestAreaList()}},r=t,_possibleConstructorReturn(s,r)}return _inherits(a,e),_createClass(a,[{key:"onLoad",value:function(e){var a=this;console.log(e),e.address_id?(wx.setNavigationBarTitle({title:"修改地址"}),(0,_ajax.ajax)({url:api.addressInfo,data:{address_id:e.address_id}}).then(function(e){a.addressInfo=e.datas.address_info,a.is_default=e.datas.address_info.is_default,a.name=e.datas.address_info.true_name,a.phone=e.datas.address_info.tel_phone,a.address=e.datas.address_info.address,a.$apply()})):wx.setNavigationBarTitle({title:"添加地址"}),this.requestAreaList()}},{key:"requestAreaList",value:function(){var e=this;(0,_ajax.ajax)({icon:"none",url:api.areaList,data:{parent_id:this.parent_id,deep:this.deep}}).then(function(a){e.parent_id=a.datas[0].area_id,e.addressArr[e.deep-1]=a.datas,e.$apply(),e.deep<3&&(e.deep++,e.requestAreaList())})}}]),a}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/addAddress"));