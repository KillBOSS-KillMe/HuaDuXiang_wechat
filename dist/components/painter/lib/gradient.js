'use strict';

/* eslint-disable */
// 当ctx传入当前文件，const grd = ctx.createCircularGradient() 和 
// const grd = this.ctx.createLinearGradient() 无效，因此只能分开处理
// 先分析，在外部创建grd，再传入使用就可以

!function () {

  var api = {
    isGradient: function isGradient(bg) {
      if (bg && (bg.startsWith('linear') || bg.startsWith('radial'))) {
        return true;
      }
      return false;
    },

    doGradient: function doGradient(bg, width, height, ctx) {
      if (bg.startsWith('linear')) {
        linearEffect(width, height, bg, ctx);
      } else if (bg.startsWith('radial')) {
        radialEffect(width, height, bg, ctx);
      }
    }
  };

  function analizeGrad(string) {
    var colorPercents = string.substring(0, string.length - 1).split("%,");
    var colors = [];
    var percents = [];
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = colorPercents[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var colorPercent = _step.value;

        colors.push(colorPercent.substring(0, colorPercent.lastIndexOf(" ")).trim());
        percents.push(colorPercent.substring(colorPercent.lastIndexOf(" "), colorPercent.length) / 100);
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return { colors: colors, percents: percents };
  }

  function radialEffect(width, height, bg, ctx) {
    var colorPer = analizeGrad(bg.match(/radial-gradient\((.+)\)/)[1]);
    var grd = ctx.createCircularGradient(0, 0, width < height ? height / 2 : width / 2);
    for (var i = 0; i < colorPer.colors.length; i++) {
      grd.addColorStop(colorPer.percents[i], colorPer.colors[i]);
    }
    ctx.fillStyle = grd;
    //ctx.fillRect(-(width / 2), -(height / 2), width, height);
  }

  function analizeLinear(bg, width, height) {
    var direction = bg.match(/([-]?\d{1,3})deg/);
    var dir = direction && direction[1] ? parseFloat(direction[1]) : 0;
    var coordinate = void 0;
    switch (dir) {
      case 0:
        coordinate = [0, -height / 2, 0, height / 2];break;
      case 90:
        coordinate = [width / 2, 0, -width / 2, 0];break;
      case -90:
        coordinate = [-width / 2, 0, width / 2, 0];break;
      case 180:
        coordinate = [0, height / 2, 0, -height / 2];break;
      case -180:
        coordinate = [0, -height / 2, 0, height / 2];break;
      default:
        var x1 = 0;
        var y1 = 0;
        var x2 = 0;
        var y2 = 0;
        if (direction[1] > 0 && direction[1] < 90) {
          x1 = width / 2 - (width / 2 * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
          y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
          x2 = -x1;
          y1 = -y2;
        } else if (direction[1] > -180 && direction[1] < -90) {
          x1 = -(width / 2) + (width / 2 * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
          y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
          x2 = -x1;
          y1 = -y2;
        } else if (direction[1] > 90 && direction[1] < 180) {
          x1 = width / 2 + (-(width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
          y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
          x2 = -x1;
          y1 = -y2;
        } else {
          x1 = -(width / 2) - (-(width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;
          y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;
          x2 = -x1;
          y1 = -y2;
        }
        coordinate = [x1, y1, x2, y2];
        break;
    }
    return coordinate;
  }

  function linearEffect(width, height, bg, ctx) {
    var param = analizeLinear(bg, width, height);
    var grd = ctx.createLinearGradient(param[0], param[1], param[2], param[3]);
    var content = bg.match(/linear-gradient\((.+)\)/)[1];
    var colorPer = analizeGrad(content.substring(content.indexOf(',') + 1));
    for (var i = 0; i < colorPer.colors.length; i++) {
      grd.addColorStop(colorPer.percents[i], colorPer.colors[i]);
    }
    ctx.fillStyle = grd;
    //ctx.fillRect(-(width / 2), -(height / 2), width, height);
  }

  module.exports = { api: api };
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdyYWRpZW50LmpzIl0sIm5hbWVzIjpbImFwaSIsImlzR3JhZGllbnQiLCJiZyIsInN0YXJ0c1dpdGgiLCJkb0dyYWRpZW50Iiwid2lkdGgiLCJoZWlnaHQiLCJjdHgiLCJsaW5lYXJFZmZlY3QiLCJyYWRpYWxFZmZlY3QiLCJhbmFsaXplR3JhZCIsInN0cmluZyIsImNvbG9yUGVyY2VudHMiLCJzdWJzdHJpbmciLCJsZW5ndGgiLCJzcGxpdCIsImNvbG9ycyIsInBlcmNlbnRzIiwiY29sb3JQZXJjZW50IiwicHVzaCIsImxhc3RJbmRleE9mIiwidHJpbSIsImNvbG9yUGVyIiwibWF0Y2giLCJncmQiLCJjcmVhdGVDaXJjdWxhckdyYWRpZW50IiwiaSIsImFkZENvbG9yU3RvcCIsImZpbGxTdHlsZSIsImFuYWxpemVMaW5lYXIiLCJkaXJlY3Rpb24iLCJkaXIiLCJwYXJzZUZsb2F0IiwiY29vcmRpbmF0ZSIsIngxIiwieTEiLCJ4MiIsInkyIiwiTWF0aCIsInRhbiIsIlBJIiwic2luIiwicGFyYW0iLCJjcmVhdGVMaW5lYXJHcmFkaWVudCIsImNvbnRlbnQiLCJpbmRleE9mIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxDQUFFLFlBQVk7O0FBRVosTUFBSUEsTUFBTTtBQUNSQyxnQkFBWSxvQkFBU0MsRUFBVCxFQUFhO0FBQ3ZCLFVBQUlBLE9BQU9BLEdBQUdDLFVBQUgsQ0FBYyxRQUFkLEtBQTJCRCxHQUFHQyxVQUFILENBQWMsUUFBZCxDQUFsQyxDQUFKLEVBQWdFO0FBQzlELGVBQU8sSUFBUDtBQUNEO0FBQ0QsYUFBTyxLQUFQO0FBQ0QsS0FOTzs7QUFRUkMsZ0JBQVksb0JBQVNGLEVBQVQsRUFBYUcsS0FBYixFQUFvQkMsTUFBcEIsRUFBNEJDLEdBQTVCLEVBQWlDO0FBQzNDLFVBQUlMLEdBQUdDLFVBQUgsQ0FBYyxRQUFkLENBQUosRUFBNkI7QUFDM0JLLHFCQUFhSCxLQUFiLEVBQW9C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QVdaLFlBQVlrQyxRQUFRL0IsU0FBUixDQUFrQitCLFFBQVFDLE9BQVIsQ0FBZ0IsR0FBaEIsSUFBdUIsQ0FBekMsQ0FBWixDQUFqQjtBQUNBLFNBQUssSUFBSW5CLElBQUksQ0FBYixFQUFnQkEsSUFBSUosU0FBU04sTUFBVCxDQUFnQkYsTUFBcEMsRUFBNENZLEdBQTVDLEVBQWlEO0FBQy9DRixVQUFJRyxZQUFKLENBQWlCTCxTQUFTTCxRQUFULENBQWtCUyxDQUFsQixDQUFqQixFQUF1Q0osU0FBU04sTUFBVCxDQUFnQlUsQ0FBaEIsQ0FBdkM7QUFDRDtBQUNEbkIsUUFBSXFCLFNBQUosR0FBZ0JKLEdBQWhCO0FBQ0E7QUFDRDs7QUFFRHNCLFNBQU9DLE9BQVAsR0FBaUIsRUFBRS9DLFFBQUYsRUFBakI7QUFFRCxDQWhHQSxFQUFEIiwiZmlsZSI6ImdyYWRpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgKi9cbi8vIOW9k2N0eOS8oOWFpeW9k+WJjeaWh+S7tu+8jGNvbnN0IGdyZCA9IGN0eC5jcmVhdGVDaXJjdWxhckdyYWRpZW50KCkg5ZKMIFxuLy8gY29uc3QgZ3JkID0gdGhpcy5jdHguY3JlYXRlTGluZWFyR3JhZGllbnQoKSDml6DmlYjvvIzlm6DmraTlj6rog73liIblvIDlpITnkIZcbi8vIOWFiOWIhuaekO+8jOWcqOWklumDqOWIm+W7umdyZO+8jOWGjeS8oOWFpeS9v+eUqOWwseWPr+S7pVxuXG4hKGZ1bmN0aW9uICgpIHtcblxuICB2YXIgYXBpID0ge1xuICAgIGlzR3JhZGllbnQ6IGZ1bmN0aW9uKGJnKSB7XG4gICAgICBpZiAoYmcgJiYgKGJnLnN0YXJ0c1dpdGgoJ2xpbmVhcicpIHx8IGJnLnN0YXJ0c1dpdGgoJ3JhZGlhbCcpKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGRvR3JhZGllbnQ6IGZ1bmN0aW9uKGJnLCB3aWR0aCwgaGVpZ2h0LCBjdHgpIHtcbiAgICAgIGlmIChiZy5zdGFydHNXaXRoKCdsaW5lYXInKSkge1xuICAgICAgICBsaW5lYXJFZmZlY3Qod2lkdGgsIGhlaWdodCwgYmcsIGN0eCk7XG4gICAgICB9IGVsc2UgaWYgKGJnLnN0YXJ0c1dpdGgoJ3JhZGlhbCcpKSB7XG4gICAgICAgIHJhZGlhbEVmZmVjdCh3aWR0aCwgaGVpZ2h0LCBiZywgY3R4KTtcbiAgICAgIH1cbiAgICB9LFxuICB9XG5cbiAgZnVuY3Rpb24gYW5hbGl6ZUdyYWQoc3RyaW5nKSB7XG4gICAgY29uc3QgY29sb3JQZXJjZW50cyA9IHN0cmluZy5zdWJzdHJpbmcoMCwgc3RyaW5nLmxlbmd0aCAtIDEpLnNwbGl0KFwiJSxcIik7XG4gICAgY29uc3QgY29sb3JzID0gW107XG4gICAgY29uc3QgcGVyY2VudHMgPSBbXTtcbiAgICBmb3IgKGxldCBjb2xvclBlcmNlbnQgb2YgY29sb3JQZXJjZW50cykge1xuICAgICAgY29sb3JzLnB1c2goY29sb3JQZXJjZW50LnN1YnN0cmluZygwLCBjb2xvclBlcmNlbnQubGFzdEluZGV4T2YoXCIgXCIpKS50cmltKCkpO1xuICAgICAgcGVyY2VudHMucHVzaChjb2xvclBlcmNlbnQuc3Vic3RyaW5nKGNvbG9yUGVyY2VudC5sYXN0SW5kZXhPZihcIiBcIiksIGNvbG9yUGVyY2VudC5sZW5ndGgpIC8gMTAwKTtcbiAgICB9XG4gICAgcmV0dXJuIHtjb2xvcnM6IGNvbG9ycywgcGVyY2VudHM6IHBlcmNlbnRzfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJhZGlhbEVmZmVjdCh3aWR0aCwgaGVpZ2h0LCBiZywgY3R4KSB7XG4gICAgY29uc3QgY29sb3JQZXIgPSBhbmFsaXplR3JhZChiZy5tYXRjaCgvcmFkaWFsLWdyYWRpZW50XFwoKC4rKVxcKS8pWzFdKTtcbiAgICBjb25zdCBncmQgPSBjdHguY3JlYXRlQ2lyY3VsYXJHcmFkaWVudCgwLCAwLCB3aWR0aCA8IGhlaWdodCA/IGhlaWdodCAvIDIgOiB3aWR0aCAvIDIpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JQZXIuY29sb3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBncmQuYWRkQ29sb3JTdG9wKGNvbG9yUGVyLnBlcmNlbnRzW2ldLCBjb2xvclBlci5jb2xvcnNbaV0pO1xuICAgIH1cbiAgICBjdHguZmlsbFN0eWxlID0gZ3JkO1xuICAgIC8vY3R4LmZpbGxSZWN0KC0od2lkdGggLyAyKSwgLShoZWlnaHQgLyAyKSwgd2lkdGgsIGhlaWdodCk7XG4gIH1cblxuICBmdW5jdGlvbiBhbmFsaXplTGluZWFyKGJnLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgY29uc3QgZGlyZWN0aW9uID0gYmcubWF0Y2goLyhbLV0/XFxkezEsM30pZGVnLyk7XG4gICAgY29uc3QgZGlyID0gZGlyZWN0aW9uICYmIGRpcmVjdGlvblsxXSA/IHBhcnNlRmxvYXQoZGlyZWN0aW9uWzFdKSA6IDA7XG4gICAgbGV0IGNvb3JkaW5hdGU7XG4gICAgc3dpdGNoIChkaXIpIHtcbiAgICAgIGNhc2UgMDogY29vcmRpbmF0ZSA9IFswLCAtaGVpZ2h0IC8gMiwgMCwgaGVpZ2h0IC8gMl07IGJyZWFrO1xuICAgICAgY2FzZSA5MDogY29vcmRpbmF0ZSA9IFt3aWR0aCAvIDIsIDAsIC13aWR0aCAvIDIsIDBdOyBicmVhaztcbiAgICAgIGNhc2UgLTkwOiBjb29yZGluYXRlID0gWy13aWR0aCAvIDIsIDAsIHdpZHRoIC8gMiwgMF07IGJyZWFrO1xuICAgICAgY2FzZSAxODA6IGNvb3JkaW5hdGUgPSBbMCwgaGVpZ2h0IC8gMiwgMCwgLWhlaWdodCAvIDJdOyBicmVhaztcbiAgICAgIGNhc2UgLTE4MDogY29vcmRpbmF0ZSA9IFswLCAtaGVpZ2h0IC8gMiwgMCwgaGVpZ2h0IC8gMl07IGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbGV0IHgxID0gMDtcbiAgICAgICAgbGV0IHkxID0gMDtcbiAgICAgICAgbGV0IHgyID0gMDtcbiAgICAgICAgbGV0IHkyID0gMDtcbiAgICAgICAgaWYgKGRpcmVjdGlvblsxXSA+IDAgJiYgZGlyZWN0aW9uWzFdIDwgOTApIHtcbiAgICAgICAgICB4MSA9ICh3aWR0aCAvIDIpIC0gKCh3aWR0aCAvIDIpICogTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAtIGhlaWdodCAvIDIpICogTWF0aC5zaW4oMiAqICg5MCAtIGRpcmVjdGlvblsxXSkgKiBNYXRoLlBJICogMiAvIDM2MCkgLyAyO1xuICAgICAgICAgIHkyID0gTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAqIHgxO1xuICAgICAgICAgIHgyID0gLXgxO1xuICAgICAgICAgIHkxID0gLXkyO1xuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvblsxXSA+IC0xODAgJiYgZGlyZWN0aW9uWzFdIDwgLTkwKSB7XG4gICAgICAgICAgeDEgPSAtKHdpZHRoIC8gMikgKyAoKHdpZHRoIC8gMikgKiBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC0gaGVpZ2h0IC8gMikgKiBNYXRoLnNpbigyICogKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAvIDI7XG4gICAgICAgICAgeTIgPSBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApICogeDE7XG4gICAgICAgICAgeDIgPSAteDE7XG4gICAgICAgICAgeTEgPSAteTI7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uWzFdID4gOTAgJiYgZGlyZWN0aW9uWzFdIDwgMTgwKSB7XG4gICAgICAgICAgeDEgPSAod2lkdGggLyAyKSArICgtKHdpZHRoIC8gMikgKiBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApIC0gaGVpZ2h0IC8gMikgKiBNYXRoLnNpbigyICogKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAvIDI7XG4gICAgICAgICAgeTIgPSBNYXRoLnRhbigoOTAgLSBkaXJlY3Rpb25bMV0pICogTWF0aC5QSSAqIDIgLyAzNjApICogeDE7XG4gICAgICAgICAgeDIgPSAteDE7XG4gICAgICAgICAgeTEgPSAteTI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgeDEgPSAtKHdpZHRoIC8gMikgLSAoLSh3aWR0aCAvIDIpICogTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAtIGhlaWdodCAvIDIpICogTWF0aC5zaW4oMiAqICg5MCAtIGRpcmVjdGlvblsxXSkgKiBNYXRoLlBJICogMiAvIDM2MCkgLyAyO1xuICAgICAgICAgIHkyID0gTWF0aC50YW4oKDkwIC0gZGlyZWN0aW9uWzFdKSAqIE1hdGguUEkgKiAyIC8gMzYwKSAqIHgxO1xuICAgICAgICAgIHgyID0gLXgxO1xuICAgICAgICAgIHkxID0gLXkyO1xuICAgICAgICB9XG4gICAgICAgIGNvb3JkaW5hdGUgPSBbeDEsIHkxLCB4MiwgeTJdO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBjb29yZGluYXRlO1xuICB9XG5cbiAgZnVuY3Rpb24gbGluZWFyRWZmZWN0KHdpZHRoLCBoZWlnaHQsIGJnLCBjdHgpIHtcbiAgICBjb25zdCBwYXJhbSA9IGFuYWxpemVMaW5lYXIoYmcsIHdpZHRoLCBoZWlnaHQpO1xuICAgIGNvbnN0IGdyZCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudChwYXJhbVswXSwgcGFyYW1bMV0sIHBhcmFtWzJdLCBwYXJhbVszXSk7XG4gICAgY29uc3QgY29udGVudCA9IGJnLm1hdGNoKC9saW5lYXItZ3JhZGllbnRcXCgoLispXFwpLylbMV07XG4gICAgY29uc3QgY29sb3JQZXIgPSBhbmFsaXplR3JhZChjb250ZW50LnN1YnN0cmluZyhjb250ZW50LmluZGV4T2YoJywnKSArIDEpKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbG9yUGVyLmNvbG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgZ3JkLmFkZENvbG9yU3RvcChjb2xvclBlci5wZXJjZW50c1tpXSwgY29sb3JQZXIuY29sb3JzW2ldKTtcbiAgICB9XG4gICAgY3R4LmZpbGxTdHlsZSA9IGdyZFxuICAgIC8vY3R4LmZpbGxSZWN0KC0od2lkdGggLyAyKSwgLShoZWlnaHQgLyAyKSwgd2lkdGgsIGhlaWdodCk7XG4gIH1cblxuICBtb2R1bGUuZXhwb3J0cyA9IHsgYXBpIH1cblxufSkoKTtcbiJdfQ==