<style lang="less">
@hundred: 100%;
.wrap {
  background: #f9f9f9;
}
//搜索
.inputSerach {
  width: 90%;
  height: 70rpx;
  background: #ececec;
  border-radius: 36rpx;
  // text-align: center;
  padding-left: 40rpx;
  color: #8e8e8e;
  font-size: small;
  margin: auto;
}
.sereach {
  width: 80rpx;
  height: 80rpx;
  // background: pink;
  position: absolute;
  top: 4px;
  left: 30px;
}
// 轮播
.mainWheel {
  width: @hundred;
  height: 380rpx;
  margin-top: 20rpx;
  .slide-image {
    width: 100%;
    height: 100%;
  }
  swiper {
    width: 100%;
    height: 100%;
  }
}
//中间选项
.mainChoose {
  width: @hundred;
  height: 380rpx;
  background: #fff;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: center;
  .chooseItem {
    width: 25%;
    height: 50%;
    position: relative;
    .chooseImg {
      position: absolute;
      top: 15%;
      left: 28%;
      width: 80rpx;
      height: 80rpx;
    }
    .chooseText {
      position: absolute;
      top: 65%;
      left: 36%;
      color: #333333;
      font-size: 26rpx;
      text-align: center;
    }
  }
  .chooseItem:nth-child(4) .chooseText {
    position: absolute;
    top: 65%;
    left: 23%;
  }
  .chooseItem:nth-child(8) .chooseText {
    position: absolute;
    top: 65%;
    left: 14%;
  }
}
//秒杀区
.seckill {
  margin-top: 20rpx;
  // 标题
  .seckilltitle {
    display: flex;
    flex-direction: row;
    justify-content: space-between;

    color: #282828;
    font-size: 32rpx;
    font-weight: bold;
    padding: 30rpx;
    background: #fff;
    .beginTime {
      color: #9e9e9e;
      font-weight: normal;
      font-size: 26rpx;
    }
  }
  // 倒计时
  .seckillCountdown {
    width: @hundred;
    // margin: auto;
    text-align: center;
    padding: 20rpx 0;
    color: #282828;
    font-size: 28rpx;
    font-weight: bold;
    background: #fff;
  }
}
// 商品
.saleShopWrap {
  width: 100%;
  height: 100%;
  background: #f9f9f9;
  .saleShop {
    width: 92%;
    height: 100%;
    margin: 20rpx auto;
    margin-bottom: 2%;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;

    // item商品
    .shopview {
              background: #fff;
              width: 335rpx;
              height: 488rpx;
              display: inline-block;
              justify-content: center;
              flex-direction: column;
              align-items: center;
              padding: 20rpx 0rpx;
              margin-bottom: 19rpx;
              border-radius: 20rpx;
              image {
                width: 327rpx;
                height: 327rpx;
              }
              .saleTag {
                font-size: 30rpx;
                font-weight: bold;
                color: #333;
                padding: 30rpx;
              }
              .salep {
                font-size: 28rpx;
                color: red;
                font-weight: bold;
                padding-left: 30rpx;
              }
              .salesmple {
                font-size: 24rpx;
                color: red;
                font-weight: normal;
              }
              .saleprice {
                font-weight: bolder;
                color: red;
                font-size: 42rpx;
              }
              .saleexprice {
                color: #666;
                font-size: 24rpx;
                font-weight: normal;
                padding-left: 25rpx;
                text-decoration: line-through;
              }
              .saletag {
                width: 60rpx;
                // height: 20rpx;
                background: red;
                text-align: center;
                line-height: 20rpx;
                font-size: 10px;
                padding: 8rpx;
                color: white;
                border-radius: 10rpx;
                margin-left: 3%;
                margin-top: -2%;
              }
            }
      }
    }
    .shopview :nth-last-child(1){
      margin-bottom: 160rpx;
    }
#getUserInfo {
  position: fixed;
  top: 0%;
  left: 0;
  bottom: 0;
  right: 0;
  opacity: 0;
  z-index: 999;
}
</style>
<template>
  <view class="wrap">
    <view>
      <image class="iconsousuo-bai sereach" />
      <!-- <input class="inputSerach "/> -->
    </view>
    <!-- 轮播 -->
    <view class="mainWheel">
      <swiper indicator-dots="true" autoplay="true" interval="2000" duration="500" circular="true">
        <repeat for="{{imgUrls}}" item="item">
          <swiper-item>
            <image src="{{requestImgUrl + item.img}}" class="slide-image" />
          </swiper-item>
        </repeat>
      </swiper>
    </view>
    <!-- 中间选项 -->
    <view class="mainChoose">
      <repeat for="{{ChooesData}}" item="item">
        <view class="chooseItem" @tap="tapName('{{item.id}}')">
          <image class="chooseImg" src="{{requestImgUrl + item.img}}" />
          <text class="chooseText">{{item.title}}</text>
        </view>
      </repeat>
    </view>
    <!-- 秒杀专区 -->
    <view class="seckill">
      <view class="seckilltitle">
        <view>秒杀专区</view>
        <view class="beginTime">下一场{{beginTime}}开始</view>
      </view>
      <!-- 倒计时 -->
      <view class="seckillCountdown">本场结束剩余</view>
      <!-- 商品 -->
      <view class="saleShopWrap">
        <view class="saleShop">
          <repeat for="{{flowData}}" item="item">
            <view class="shopview" @tap="jumpTimeDetails('{{item.id}}')">
              <image src="{{requestImgUrl + item.img}}"  />
              <view class="saleTag">
                <text>{{item.title}}</text>
              </view>
              <view>
                <view>
                  <text class="salep">秒杀价</text>
                  <text class="salesmple">￥</text>
                  <text class="saleprice">{{item.price}}</text>
                  <text class="saleexprice">原价￥ {{item.exprice}}</text>
                </view>
                <!-- <text class="salep">秒杀价</text>
                <text class="saleprice">
                  <text class="salesmple">￥</text>
                  {{item.price}}
                </text>
                <text class="saleexprice">原价￥ {{item.exprice}}</text> -->
                <!-- <text class="saletag" wx:if="{{ tagFour }}">{{item.tag}}</text> -->
              </view>
            </view>
          </repeat>
        </view>
      </view>
    </view>
    <button
      open-type="getUserInfo"
      id="getUserInfo"
      wx:if="{{userInfoButtonShow}}"
      lang="zh_CN"
      bindgetuserinfo="onGetUserInfo"
    ></button>
    <!-- <button open-type="getUserInfo" id="getUserInfo" lang="zh_CN" @getuserinfo="onGetUserInfo"></button> -->

    <nav @childFn.user="goPage" />
  </view>
</template>

<script>
import wepy from 'wepy';
import nav from '../components/nav'; // 底部导航

export default class Index extends wepy.page {
  config = {
    navigationBarTitleText: '首页',
    navigationBarBackgroundColor: 'white'
  };
  components = {
    nav: nav
  };

  mixins = [];

  data = {
    chooesId:'',
    userInfoButtonShow: true,
    userInfo: {},
    requestImgUrl: '',
    beginTime: '18:00',
    ChooesData: [
      { id: '1', img: 'sale.png', title: '促销' },
      { id: '2', img: 'pre.png', title: '预购' },
      { id: '3', img: 'discount.png', title: '折扣' },
      { id: '4', img: 'doublesale.png', title: '组合促销' },
      { id: '5', img: 'bargain.png', title: '砍价' },
      { id: '6', img: 'assemble.png', title: '拼团' },
      { id: '7', img: 'seckill.png', title: '秒杀' },
      { id: '8', img: 'turntable.png', title: '幸运大转盘' }
    ],
    flowData: [
      {
        id: '1',
        title: '萌分订书机',
        price: '5',
        exprice: '25',
        img: 'indeximg.png'
      },
      {
        id: '2',
        title: '萌分订书机',
        price: '5',
        exprice: '25',
        img: 'indeximg.png'
      },
      {
        id: '3',
        title: '萌分订书机',
        price: '5',
        exprice: '25',
        img: 'indeximg.png'
      },
      {
        id: '4',
        title: '萌分订书机',
        price: '5',
        exprice: '25',
        img: 'indeximg.png'
      },
      {
        id: '5',
        title: '萌分订书机',
        price: '5',
        exprice: '25',
        img: 'indeximg.png'
      },
      {
        id: '6',
        title: '萌分订书机',
        price: '5',
        exprice: '25',
        img: 'indeximg.png'
      }
    ],
    // 轮播
    imgUrls: [
      { id: '1', img: 'indexlunbo.png' },
      { id: '2', img: 'indexlunbo.png' },
      { id: '3', img: 'indexlunbo.png' },
      { id: '4', img: 'indexlunbo.png' }
    ]
  };

  computed = {};
  onLoad() {
    this.onGetUserInfo();
  }
  onShow() {
      // this.userInfo = this.$parent.globalData.userInfo
    this.requestImgUrl = this.$parent.globalData.requestImgUrl
  }
  methods = {
    /**
     * 中间选择
     */
    tapName(id) {
      if (id == 1) {
        this.$navigate({ url: `sale?id=${id}` });
      } else if (id == 2) {
        this.$navigate({ url: `pre?id=${id}` });
      } else if (id == 3) {
        this.$navigate({ url: `discount?id=${id}` });
      } else if (id == 4) {
        this.$navigate({ url: `sale?id=${id}` });
      } else if (id == 5) {
        this.$navigate({ url: `bargain?id=${id}` });
      } else if (id == 6) {
        this.$navigate({ url: `assemble?id=${id}` });
      } else if (id == 7) {
        this.$navigate({ url: `seckill?id=${id}` });
      }
    },
    /**
     * 跳转商品详情
     */
    jumpTimeDetails(shopid){
      console.log('shopid',shopid)
      this.$navigate(`/pages/shopDetails?shopid=${shopid}`)
    },
    /**
     * 底部导航跳转
     */
    goPage(url, evt) {
      // 销毁当前页{跳转}
      this.$redirect(url);
    }
  };

  events = {};

  /**
   * 授权
   */
  onGetUserInfo(req) {
    // 查看是否授权
    wx.getSetting({
      success: res => {
        if (res.authSetting['scope.userInfo']) {
          this.userInfoButtonShow = false
          // 已经授权，可以直接调用 getUserInfo 获取头像昵称
          wx.getUserInfo({
            success: res => {
              this.userInfo = res.userInfo;
              this.$parent.globalData.userInfo = this.userInfo;
              console.log(this.$parent.globalData.userInfo);

              // let avatarUrl = res.userInfo.avatarUrl
              // //登录
              // wx.login({
              //   success: res => {

              //     if (res.code) {
              //       //发起网络请求
              //       wx.request({
              //         url: app.config.backUrl + 'apiLogin/login',
              //         method: 'POST',
              //         data: {
              //           img: avatarUrl,
              //           code: res.code
              //         },
              //         success: function(res) {
              //           /**世豪信息 */
              //           app.globalData.userInfo = res.data.data
              //           // 存用户id
              //           app.globalData.uid = res.data.data.id

              //           // 存token
              //           // console.log('token=' + res.data.data.token)
              //         }
              //       })
              //     } else {
              //       console.log('获取用户登录态失败！' + res.errMsg)
              //     }
              //   }
              // })
              // app.globalData.userInfo = userInfo
              // if (this.data.userInfo) {
              //   // 提交用户信息
              //   // this.setUserInfo(this.userInfo)
              //   app.globalData.userInfo = this.userInfo
              //   this.$apply()
              // }
            }
          });
        } else {
          // this.clickWeekBangs()
        }
      }
    });
  }
}
</script>
